(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const Y=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,t,{onPreviewPicture:o,onLikeIcon:n,onDeleteCard:r})=>{const s=Y(),l=s.querySelector(".card__like-button"),T=s.querySelector(".card__control-button_type_delete"),b=s.querySelector(".card__image"),P=s.querySelector(".card__like-count");b.src=e.link,b.alt=e.name,s.querySelector(".card__title").textContent=e.name;const Q=e.likes?e.likes.length:0;P.textContent=Q;const A=e.likes&&e.likes.some(X=>X._id===t);return A&&l.classList.add("card__like-button_is-active"),e.owner._id!==t&&T.remove(),n&&l.addEventListener("click",()=>n(e._id,A,l,P)),r&&e.owner._id===t&&T.addEventListener("click",()=>r(e._id,s)),o&&b.addEventListener("click",()=>o({name:e.name,link:e.link})),s},O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},Z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&a(e)})},ee=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r&&(r.textContent=o,r.classList.add(n.errorClass))},W=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n&&(n.textContent="",n.classList.remove(o.errorClass))},te=(e,t,o)=>{const n=t.dataset.errorMessage,r=t.validity.valid;let s="";r?W(e,t,o):(t.validity.patternMismatch&&n?s=n:s=t.validationMessage,ee(e,t,s,o))},oe=e=>e.some(t=>!t.validity.valid),V=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},re=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},$=(e,t,o)=>{oe(e)?V(t,o):re(t,o)},ne=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);$(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{te(e,r,t),$(o,n,t)})})},g=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{W(e,r,t)}),V(n,t)},se=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{ne(o,e)})},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"478119c7-75a2-48ac-b260-0fb475b917c1","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ce=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(u),j=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(u),le=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(u),ae=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(u),ie=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(u),ue=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(u),de=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(u),J=document.querySelector(".places__list"),E=document.querySelector(".popup_type_edit"),_=E.querySelector(".popup__form"),R=_.querySelector(".popup__input_type_name"),H=_.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_new-card"),i=k.querySelector(".popup__form"),pe=i.querySelector(".popup__input_type_card-name"),me=i.querySelector(".popup__input_type_url"),x=document.querySelector(".popup_type_image"),F=x.querySelector(".popup__image"),_e=x.querySelector(".popup__caption"),fe=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),w=document.querySelector(".profile__description"),B=document.querySelector(".profile__image"),M=document.querySelector(".popup_type_edit-avatar"),p=M.querySelector(".popup__form"),he=p.querySelector(".popup__input"),f=document.querySelector(".popup_type_remove-card"),z=f.querySelector(".popup__form"),y=document.querySelector(".popup_type_info"),Se=y.querySelector(".popup__title"),d=y.querySelector(".popup__info"),ve=y.querySelector(".popup__text"),h=y.querySelector(".popup__list"),Ce=document.querySelector(".header__logo");let L=null,S=null,v=null;const C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},U=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),q=(e,t)=>{const n=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},K=({name:e,link:t})=>{F.src=t,F.alt=e,_e.textContent=e,m(x)},be=e=>{e.preventDefault();const t=_.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,le({name:R.value,about:H.value}).then(n=>{I.textContent=n.name,w.textContent=n.about,a(E)}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},qe=e=>{e.preventDefault();const t=p.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,ae(he.value).then(n=>{B.style.backgroundImage=`url(${n.avatar})`,p.reset(),a(M)}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},Le=e=>{e.preventDefault();const t=i.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",t.disabled=!0,ie({name:pe.value,link:me.value}).then(n=>{J.prepend(N(n,L,{onPreviewPicture:K,onLikeIcon:D,onDeleteCard:G})),i.reset(),a(k)}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},D=(e,t,o,n)=>{de(e,t).then(r=>{o.classList.toggle("card__like-button_is-active"),n.textContent=r.likes.length}).catch(()=>{})},G=(e,t)=>{S=e,v=t,m(f)},ge=e=>{e.preventDefault();const t=z.querySelector(".popup__button"),o=t.textContent;t.textContent="Удаление...",t.disabled=!0,ue(S).then(()=>{v.remove(),a(f),S=null,v=null}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},Ee=()=>{for(;d.firstChild;)d.removeChild(d.firstChild);for(;h.firstChild;)h.removeChild(h.firstChild);j().then(e=>{const t=[...e].sort((r,s)=>new Date(s.createdAt)-new Date(r.createdAt));Se.textContent="Статистика",d.append(q("Всего карточек:",e.length.toString())),t.length>0&&(d.append(q("Первая создана:",U(new Date(t[t.length-1].createdAt)))),d.append(q("Последняя создана:",U(new Date(t[0].createdAt)))));const o=new Map;e.forEach(r=>{const s=r.owner._id;o.has(s)||o.set(s,{name:r.owner.name,avatar:r.owner.avatar,cardsCount:0}),o.get(s).cardsCount++}),ve.textContent="Пользователи:";const n=document.getElementById("popup-info-user-preview-template");o.forEach(r=>{const s=n.content.cloneNode(!0),l=s.querySelector(".popup__list-item");l.textContent=`${r.name} (${r.cardsCount})`,r.avatar&&(l.style.backgroundImage=`url(${r.avatar})`),h.append(s)}),m(y)}).catch(()=>{})};_.addEventListener("submit",be);i.addEventListener("submit",Le);p.addEventListener("submit",qe);z.addEventListener("submit",ge);fe.addEventListener("click",()=>{R.value=I.textContent,H.value=w.textContent,g(_,C),m(E)});B.addEventListener("click",()=>{p.reset(),g(p,C),m(M)});ye.addEventListener("click",()=>{i.reset(),g(i,C),m(k)});Ce.addEventListener("click",Ee);Promise.all([j(),ce()]).then(([e,t])=>{L=t._id,I.textContent=t.name,w.textContent=t.about,B.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{J.append(N(o,L,{onPreviewPicture:K,onLikeIcon:D,onDeleteCard:G}))})}).catch(()=>{});const ke=document.querySelectorAll(".popup");ke.forEach(e=>{Z(e)});const xe=f.querySelector(".popup__close");xe.addEventListener("click",()=>{a(f),S=null,v=null});se(C);
