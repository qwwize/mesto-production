(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const Y=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,t,{onPreviewPicture:n,onLikeIcon:r,onDeleteCard:o})=>{const s=Y(),l=s.querySelector(".card__like-button"),M=s.querySelector(".card__control-button_type_delete"),b=s.querySelector(".card__image"),T=s.querySelector(".card__like-count");b.src=e.link,b.alt=e.name,s.querySelector(".card__title").textContent=e.name;const Q=e.likes?e.likes.length:0;T.textContent=Q;const P=e.likes&&e.likes.some(X=>X._id===t);return P&&l.classList.add("card__like-button_is-active"),e.owner._id!==t&&M.remove(),r&&l.addEventListener("click",()=>r(e._id,P,l,T)),o&&e.owner._id===t&&M.addEventListener("click",()=>o(e._id,s)),n&&b.addEventListener("click",()=>n({name:e.name,link:e.link})),s},O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},Z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",n=>{n.target.classList.contains("popup")&&a(e)})},ee=(e,t,n,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),o&&(o.textContent=n,o.classList.add(r.errorClass))},W=(e,t,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(n.inputErrorClass),r&&(r.textContent="",r.classList.remove(n.errorClass))},te=(e,t,n)=>{const r=t.dataset.errorMessage,o=t.validity.valid;let s="";o?W(e,t,n):(t.validity.patternMismatch&&r?s=r:s=t.validationMessage,ee(e,t,s,n))},oe=e=>e.some(t=>!t.validity.valid),H=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},ne=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},A=(e,t,n)=>{oe(e)?H(t,n):ne(t,n)},re=(e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);A(n,r,t),n.forEach(o=>{o.addEventListener("input",()=>{te(e,o,t),A(n,r,t)})})},q=(e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach(o=>{W(e,o,t)}),H(r,t)},se=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(n=>{re(n,e)})},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"478119c7-75a2-48ac-b260-0fb475b917c1","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ce=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(u),V=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(u),le=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(u),ae=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(u),ie=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(u),ue=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(u),de=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(u),j=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),m=L.querySelector(".popup__form"),J=m.querySelector(".popup__input_type_name"),R=m.querySelector(".popup__input_type_description"),E=document.querySelector(".popup_type_new-card"),i=E.querySelector(".popup__form"),pe=i.querySelector(".popup__input_type_card-name"),me=i.querySelector(".popup__input_type_url"),k=document.querySelector(".popup_type_image"),$=k.querySelector(".popup__image"),_e=k.querySelector(".popup__caption"),fe=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),w=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),d=B.querySelector(".popup__form"),he=d.querySelector(".popup__input"),_=document.querySelector(".popup_type_remove-card"),z=_.querySelector(".popup__form"),f=document.querySelector(".popup_type_info"),Se=f.querySelector(".popup__title"),y=f.querySelector(".popup__info"),ve=f.querySelector(".popup__text"),F=f.querySelector(".popup__list"),be=document.querySelector(".header__logo");let g=null,h=null,S=null;const v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},U=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),C=(e,t)=>{const r=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},K=({name:e,link:t})=>{$.src=t,$.alt=e,_e.textContent=e,p(k)},Ce=e=>{e.preventDefault();const t=m.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",t.disabled=!0,le({name:J.value,about:R.value}).then(r=>{x.textContent=r.name,I.textContent=r.about,a(L)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=n,t.disabled=!1})},ge=e=>{e.preventDefault();const t=d.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",t.disabled=!0,ae(he.value).then(r=>{w.style.backgroundImage=`url(${r.avatar})`,d.reset(),a(B)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=n,t.disabled=!1})},qe=e=>{e.preventDefault();const t=i.querySelector(".popup__button"),n=t.textContent;t.textContent="Создание...",t.disabled=!0,ie({name:pe.value,link:me.value}).then(r=>{j.prepend(N(r,g,{onPreviewPicture:K,onLikeIcon:D,onDeleteCard:G})),i.reset(),a(E)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=n,t.disabled=!1})},D=(e,t,n,r)=>{de(e,t).then(o=>{n.classList.toggle("card__like-button_is-active"),r.textContent=o.likes.length}).catch(o=>{console.log(o)})},G=(e,t)=>{h=e,S=t,p(_)},Le=e=>{e.preventDefault();const t=z.querySelector(".popup__button"),n=t.textContent;t.textContent="Удаление...",t.disabled=!0,ue(h).then(()=>{S.remove(),a(_),h=null,S=null}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=n,t.disabled=!1})},Ee=()=>{y.innerHTML="",F.innerHTML="",V().then(e=>{const t=[...e].sort((o,s)=>new Date(s.createdAt)-new Date(o.createdAt));Se.textContent="Статистика",y.append(C("Всего карточек:",e.length.toString())),t.length>0&&(y.append(C("Первая создана:",U(new Date(t[t.length-1].createdAt)))),y.append(C("Последняя создана:",U(new Date(t[0].createdAt)))));const n=new Map;e.forEach(o=>{const s=o.owner._id;n.has(s)||n.set(s,{name:o.owner.name,avatar:o.owner.avatar,cardsCount:0}),n.get(s).cardsCount++}),ve.textContent="Пользователи:";const r=document.getElementById("popup-info-user-preview-template");n.forEach(o=>{const s=r.content.cloneNode(!0),l=s.querySelector(".popup__list-item");l.textContent=`${o.name} (${o.cardsCount})`,o.avatar&&(l.style.backgroundImage=`url(${o.avatar})`),F.append(s)}),p(f)}).catch(e=>{console.log(e)})};m.addEventListener("submit",Ce);i.addEventListener("submit",qe);d.addEventListener("submit",ge);z.addEventListener("submit",Le);fe.addEventListener("click",()=>{J.value=x.textContent,R.value=I.textContent,q(m,v),p(L)});w.addEventListener("click",()=>{d.reset(),q(d,v),p(B)});ye.addEventListener("click",()=>{i.reset(),q(i,v),p(E)});be.addEventListener("click",Ee);Promise.all([V(),ce()]).then(([e,t])=>{g=t._id,x.textContent=t.name,I.textContent=t.about,w.style.backgroundImage=`url(${t.avatar})`,e.forEach(n=>{j.append(N(n,g,{onPreviewPicture:K,onLikeIcon:D,onDeleteCard:G}))})}).catch(e=>{console.log(e)});const ke=document.querySelectorAll(".popup");ke.forEach(e=>{Z(e)});const xe=_.querySelector(".popup__close");xe.addEventListener("click",()=>{a(_),h=null,S=null});se(v);
