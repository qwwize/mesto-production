(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const Y=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,t,{onPreviewPicture:o,onLikeIcon:r,onDeleteCard:n})=>{const s=Y(),l=s.querySelector(".card__like-button"),M=s.querySelector(".card__control-button_type_delete"),b=s.querySelector(".card__image"),T=s.querySelector(".card__like-count");b.src=e.link,b.alt=e.name,s.querySelector(".card__title").textContent=e.name;const Q=e.likes?e.likes.length:0;T.textContent=Q;const P=e.likes&&e.likes.some(X=>X._id===t);return P&&l.classList.add("card__like-button_is-active"),e.owner._id!==t&&M.remove(),r&&l.addEventListener("click",()=>r(e._id,P,l,T)),n&&e.owner._id===t&&M.addEventListener("click",()=>n(e._id,s)),o&&b.addEventListener("click",()=>o({name:e.name,link:e.link})),s},O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},Z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&a(e)})},ee=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n&&(n.textContent=o,n.classList.add(r.errorClass))},W=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r&&(r.textContent="",r.classList.remove(o.errorClass))},te=(e,t,o)=>{const r=t.dataset.errorMessage,n=t.validity.valid;let s="";n?W(e,t,o):(t.validity.patternMismatch&&r?s=r:s=t.validationMessage,ee(e,t,s,o))},oe=e=>e.some(t=>!t.validity.valid),H=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},ne=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},A=(e,t,o)=>{oe(e)?H(t,o):ne(t,o)},re=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);A(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{te(e,n,t),A(o,r,t)})})},L=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{W(e,n,t)}),H(r,t)},se=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{re(o,e)})},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"478119c7-75a2-48ac-b260-0fb475b917c1","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ce=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(u),V=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(u),le=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(u),ae=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(u),ie=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(u),ue=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(u),de=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(u),j=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),m=g.querySelector(".popup__form"),J=m.querySelector(".popup__input_type_name"),R=m.querySelector(".popup__input_type_description"),E=document.querySelector(".popup_type_new-card"),i=E.querySelector(".popup__form"),pe=i.querySelector(".popup__input_type_card-name"),me=i.querySelector(".popup__input_type_url"),k=document.querySelector(".popup_type_image"),$=k.querySelector(".popup__image"),_e=k.querySelector(".popup__caption"),fe=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),w=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),d=B.querySelector(".popup__form"),Se=d.querySelector(".popup__input"),_=document.querySelector(".popup_type_remove-card"),z=_.querySelector(".popup__form"),f=document.querySelector(".popup_type_info"),he=f.querySelector(".popup__title"),y=f.querySelector(".popup__info"),ve=f.querySelector(".popup__text"),F=f.querySelector(".popup__list"),be=document.querySelector(".header__logo");let q=null,S=null,h=null;const v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},U=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),C=(e,t)=>{const r=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},K=({name:e,link:t})=>{$.src=t,$.alt=e,_e.textContent=e,p(k)},Ce=e=>{e.preventDefault();const t=m.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,le({name:J.value,about:R.value}).then(r=>{x.textContent=r.name,I.textContent=r.about,a(g)}).finally(()=>{t.textContent=o,t.disabled=!1})},qe=e=>{e.preventDefault();const t=d.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,ae(Se.value).then(r=>{w.style.backgroundImage=`url(${r.avatar})`,d.reset(),a(B)}).finally(()=>{t.textContent=o,t.disabled=!1})},Le=e=>{e.preventDefault();const t=i.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",t.disabled=!0,ie({name:pe.value,link:me.value}).then(r=>{j.prepend(N(r,q,{onPreviewPicture:K,onLikeIcon:D,onDeleteCard:G})),i.reset(),a(E)}).finally(()=>{t.textContent=o,t.disabled=!1})},D=(e,t,o,r)=>{de(e,t).then(n=>{o.classList.toggle("card__like-button_is-active"),r.textContent=n.likes.length})},G=(e,t)=>{S=e,h=t,p(_)},ge=e=>{e.preventDefault();const t=z.querySelector(".popup__button"),o=t.textContent;t.textContent="Удаление...",t.disabled=!0,ue(S).then(()=>{h.remove(),a(_),S=null,h=null}).finally(()=>{t.textContent=o,t.disabled=!1})},Ee=()=>{y.innerHTML="",F.innerHTML="",V().then(e=>{const t=[...e].sort((n,s)=>new Date(s.createdAt)-new Date(n.createdAt));he.textContent="Статистика",y.append(C("Всего карточек:",e.length.toString())),t.length>0&&(y.append(C("Первая создана:",U(new Date(t[t.length-1].createdAt)))),y.append(C("Последняя создана:",U(new Date(t[0].createdAt)))));const o=new Map;e.forEach(n=>{const s=n.owner._id;o.has(s)||o.set(s,{name:n.owner.name,avatar:n.owner.avatar,cardsCount:0}),o.get(s).cardsCount++}),ve.textContent="Пользователи:";const r=document.getElementById("popup-info-user-preview-template");o.forEach(n=>{const s=r.content.cloneNode(!0),l=s.querySelector(".popup__list-item");l.textContent=`${n.name} (${n.cardsCount})`,n.avatar&&(l.style.backgroundImage=`url(${n.avatar})`),F.append(s)}),p(f)})};m.addEventListener("submit",Ce);i.addEventListener("submit",Le);d.addEventListener("submit",qe);z.addEventListener("submit",ge);fe.addEventListener("click",()=>{J.value=x.textContent,R.value=I.textContent,L(m,v),p(g)});w.addEventListener("click",()=>{d.reset(),L(d,v),p(B)});ye.addEventListener("click",()=>{i.reset(),L(i,v),p(E)});be.addEventListener("click",Ee);Promise.all([V(),ce()]).then(([e,t])=>{q=t._id,x.textContent=t.name,I.textContent=t.about,w.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{j.append(N(o,q,{onPreviewPicture:K,onLikeIcon:D,onDeleteCard:G}))})});const ke=document.querySelectorAll(".popup");ke.forEach(e=>{Z(e)});const xe=_.querySelector(".popup__close");xe.addEventListener("click",()=>{a(_),S=null,h=null});se(v);
