(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const Y=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,t,{onPreviewPicture:o,onLikeIcon:r,onDeleteCard:n})=>{const s=Y(),c=s.querySelector(".card__like-button"),a=s.querySelector(".card__control-button_type_delete"),f=s.querySelector(".card__image"),A=s.querySelector(".card__like-count");f.src=e.link,f.alt=e.name,s.querySelector(".card__title").textContent=e.name;const Q=e.likes?e.likes.length:0;A.textContent=Q;const P=e.likes&&e.likes.some(X=>X._id===t);return P&&c.classList.add("card__like-button_is-active"),e.owner._id!==t&&a.remove(),r&&c.addEventListener("click",()=>r(e._id,P,c,A)),n&&e.owner._id===t&&a.addEventListener("click",()=>n(e._id,s)),o&&f.addEventListener("click",()=>o({name:e.name,link:e.link})),s},O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},Z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},ee=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n&&(n.textContent=o,n.classList.add(r.errorClass))},W=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r&&(r.textContent="",r.classList.remove(o.errorClass))},te=(e,t,o)=>{const r=t.dataset.errorMessage,n=t.validity.valid;let s="";n?W(e,t,o):(t.validity.patternMismatch&&r?s=r:s=t.validationMessage,ee(e,t,s,o))},oe=e=>e.some(t=>!t.validity.valid),V=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},re=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},$=(e,t,o)=>{oe(e)?V(t,o):re(t,o)},ne=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);$(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{te(e,n,t),$(o,r,t)})})},E=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{W(e,n,t)}),V(r,t)},se=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{ne(o,e)})},l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"478119c7-75a2-48ac-b260-0fb475b917c1","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ce=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(p),j=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(p),le=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(p),ae=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(p),ie=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(p),ue=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(p),de=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(p),J=document.querySelector(".places__list"),x=document.querySelector(".popup_type_edit"),h=x.querySelector(".popup__form"),R=h.querySelector(".popup__input_type_name"),z=h.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_new-card"),d=k.querySelector(".popup__form"),pe=d.querySelector(".popup__input_type_card-name"),me=d.querySelector(".popup__input_type_url"),w=document.querySelector(".popup_type_image"),F=w.querySelector(".popup__image"),_e=w.querySelector(".popup__caption"),fe=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_edit-avatar"),m=T.querySelector(".popup__form"),he=m.querySelector(".popup__input"),S=document.querySelector(".popup_type_remove-card"),D=S.querySelector(".popup__form"),v=document.querySelector(".popup_type_info"),Se=v.querySelector(".popup__title"),i=v.querySelector(".popup__info"),ve=v.querySelector(".popup__text"),C=v.querySelector(".popup__list"),Ce=document.querySelector(".header__logo");let g=null,b=null,q=null;const L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},U=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),y=(e,t)=>{const r=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},H=({name:e,link:t})=>{F.src=t,F.alt=e,_e.textContent=e,_(w)},be=e=>{e.preventDefault();const t=h.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,le({name:R.value,about:z.value}).then(r=>{I.textContent=r.name,B.textContent=r.about,u(x)}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},qe=e=>{e.preventDefault();const t=m.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,ae(he.value).then(r=>{M.style.backgroundImage=`url(${r.avatar})`,m.reset(),u(T)}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},Le=e=>{e.preventDefault();const t=d.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",t.disabled=!0,ie({name:pe.value,link:me.value}).then(r=>{J.prepend(N(r,g,{onPreviewPicture:H,onLikeIcon:K,onDeleteCard:G})),d.reset(),u(k)}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},K=(e,t,o,r)=>{de(e,t).then(n=>{o.classList.toggle("card__like-button_is-active"),r.textContent=n.likes.length}).catch(()=>{})},G=(e,t)=>{b=e,q=t,_(S)},ge=e=>{e.preventDefault();const t=D.querySelector(".popup__button"),o=t.textContent;t.textContent="Удаление...",t.disabled=!0,ue(b).then(()=>{q.remove(),u(S),b=null,q=null}).catch(()=>{}).finally(()=>{t.textContent=o,t.disabled=!1})},Ee=()=>{for(;i.firstChild;)i.removeChild(i.firstChild);for(;C.firstChild;)C.removeChild(C.firstChild);j().then(e=>{const t=[...e].sort((c,a)=>new Date(a.createdAt)-new Date(c.createdAt));Se.textContent="Статистика пользователей",i.append(y("Всего карточек:",e.length.toString())),t.length>0&&(i.append(y("Первая создана:",U(new Date(t[t.length-1].createdAt)))),i.append(y("Последняя создана:",U(new Date(t[0].createdAt)))));const o=new Map;e.forEach(c=>{const a=c.owner._id;o.has(a)||o.set(a,{name:c.owner.name,avatar:c.owner.avatar,cardsCount:0}),o.get(a).cardsCount++});const r=o.size,n=Math.max(...Array.from(o.values()).map(c=>c.cardsCount));i.append(y("Всего пользователей:",r.toString())),i.append(y("Максимум карточек от одного:",n.toString())),ve.textContent="Все пользователи:";const s=document.getElementById("popup-info-user-preview-template");o.forEach(c=>{const a=s.content.cloneNode(!0),f=a.querySelector(".popup__list-item");f.textContent=`${c.name} (${c.cardsCount})`,C.append(a)}),_(v)}).catch(()=>{})};h.addEventListener("submit",be);d.addEventListener("submit",Le);m.addEventListener("submit",qe);D.addEventListener("submit",ge);fe.addEventListener("click",()=>{R.value=I.textContent,z.value=B.textContent,E(h,L),_(x)});M.addEventListener("click",()=>{m.reset(),E(m,L),_(T)});ye.addEventListener("click",()=>{d.reset(),E(d,L),_(k)});Ce.addEventListener("click",Ee);Promise.all([j(),ce()]).then(([e,t])=>{g=t._id,I.textContent=t.name,B.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{J.append(N(o,g,{onPreviewPicture:H,onLikeIcon:K,onDeleteCard:G}))})}).catch(()=>{});const xe=document.querySelectorAll(".popup");xe.forEach(e=>{Z(e)});const ke=S.querySelector(".popup__close");ke.addEventListener("click",()=>{u(S),b=null,q=null});se(L);
